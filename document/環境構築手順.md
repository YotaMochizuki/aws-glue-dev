# AWS Glue ジョブ 開発環境構築手順


## 1. Githubリポジトリ設定

### 1.1 SSHキーを作成してGithubにアップロード
```bash
# 生成コマンド
ssh-keygen -t rsa -b 4096 -C "your-email@example.com"
```

### 1.2 `.bash_profile`へ下記を書き込み
``` bash
# 最初に SSH_AUTH_SOCK（ssh-agent のソケットパス）が未定義か確認
if [ -z "$SSH_AUTH_SOCK" ]; then
    # ssh-agent をバックグラウンドで起動し、その環境変数を現在のシェルに設定
    eval "$(ssh-agent -s)" > /dev/null
fi

# もう一度 SSH_AUTH_SOCK をチェック（上の eval に失敗した場合も考慮）
if [ -z "$SSH_AUTH_SOCK" ]; then
    # 現在実行中の ssh-agent プロセスが存在するかを確認
    RUNNING_AGENT="`ps -ax | grep 'ssh-agent -s' | grep -v grep | wc -l | tr -d '[:space:]'`"
    if [ "$RUNNING_AGENT" = "0" ]; then
        # ssh-agent が動作していない場合、新しく起動し、
        # その出力（環境変数定義）をファイルに保存
        ssh-agent -s &> $HOME/.ssh/ssh-agent
    fi

    # 保存された ssh-agent の環境変数定義を読み込む
    eval `cat $HOME/.ssh/ssh-agent` > /dev/null

    # 登録済みの SSH 秘密鍵がなければ、ssh-add により追加（エラーは無視）
    ssh-add 2> /dev/null
fi
```

### 1.3 `~/.ssh/config` を用意する（必要なら）
```conf
# ~/.ssh/config
Host github.com
  HostName github.com
  User git
  IdentityFile ~/.ssh/github
IdentitiesOnly yes
```

---

## 2. 環境変数設定
### 2.1 下記のような`.env`ファイルをワーキングフォルダ直下に配置する
```.env
AWS_REGION=ap-northeast-1
S3_TABLES_BUCKET=arn:aws:s3tables:ap-northeast-1:577104691349:bucket/s3tables-test-bucket-mochizuki
```
- `AWS_REGION`: 開発で利用するAWSリージョン
- `S3_TABLES_BUCKET`: 開発で利用するS3TablesバケットのARN

---

## 3. Dev Containers 起動
### 3.1 下記手順に従い Dev Containers 起動
1. `ctrl + P`でコマンドパレットを開く
2. `Dev Containers: Rebuild and Reopen in Container` を実行

---